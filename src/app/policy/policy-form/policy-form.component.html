<form [formGroup]="policyForm" (ngSubmit)="handleSubmit()">
  <mat-stepper [linear]="isLinear" #stepper>
     <!-- Step 1: Basic Information -->
     <mat-step [stepControl]="basicInfoForm">
      <ng-template matStepLabel>Basic Information</ng-template>
      <form [formGroup]="basicInfoForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>Vehicle Type</mat-label>
            <mat-select formControlName="vehicleType" required>
              <mat-option *ngFor="let type of vehicleTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
            <mat-error *ngIf="basicInfoForm.get('vehicleType')?.hasError('required')">
              Vehicle Type is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Make</mat-label>
            <input matInput formControlName="make" placeholder="Enter make" required maxlength="100">
            <mat-error *ngIf="basicInfoForm.get('make')?.hasError('required')">
              Make is required.
            </mat-error>
            <mat-error *ngIf="basicInfoForm.get('make')?.hasError('pattern')">
              Make must be alphanumeric.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Model</mat-label>
            <input matInput formControlName="model" placeholder="Enter model" required maxlength="100">
            <mat-error *ngIf="basicInfoForm.get('model')?.hasError('required')">
              Model is required.
            </mat-error>
            <mat-error *ngIf="basicInfoForm.get('model')?.hasError('pattern')">
              Model must be alphanumeric.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 2: Vehicle Details -->
    <mat-step [stepControl]="vehicleDetailsForm">
      <ng-template matStepLabel>Vehicle Details</ng-template>
      <form [formGroup]="vehicleDetailsForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>Model Year</mat-label>
            <input matInput formControlName="modelYear" type="text" placeholder="Enter model year" required maxlength="4">
            <mat-error *ngIf="vehicleDetailsForm.get('modelYear')?.hasError('required')">
              Model Year is required.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('modelYear')?.hasError('minlength')">
              Model Year must be at least 4 digits.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('modelYear')?.hasError('yearInvalid')">
              {{ vehicleDetailsForm.get('modelYear')?.errors?.['yearInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Purchase Year</mat-label>
            <input matInput formControlName="purchaseYear" type="text" placeholder="Enter purchase year" required maxlength="4">
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseYear')?.hasError('required')">
              Purchase Year is required.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseYear')?.hasError('minlength')">
              Purchase Year must be at least 4 digits.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseYear')?.hasError('yearInvalid')">
              {{ vehicleDetailsForm.get('purchaseYear')?.errors?.['yearInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Purchase Amount</mat-label>
            <input matInput formControlName="purchaseAmount" type="number" placeholder="Enter purchase amount" required>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseAmount')?.hasError('required')">
              Purchase Amount is required.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseAmount')?.hasError('purchaseAmountInvalid')">
              Purchase Amount must be greater than 0.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 3: Additional Details -->
    <mat-step [stepControl]="additionalDetailsForm">
      <ng-template matStepLabel>Additional Details</ng-template>
      <form [formGroup]="additionalDetailsForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>VIN</mat-label>
            <input matInput formControlName="vin" placeholder="Enter VIN" required maxlength="17">
            <mat-error *ngIf="additionalDetailsForm.get('vin')?.hasError('required')">
              VIN is required.
            </mat-error>
            <mat-error *ngIf="additionalDetailsForm.get('vin')?.hasError('vinInvalid')">
              {{ additionalDetailsForm.get('vin')?.errors?.['vinInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Engine Number</mat-label>
            <input matInput formControlName="engineNo" placeholder="Enter engine number" required maxlength="10">
            <mat-error *ngIf="additionalDetailsForm.get('engineNo')?.hasError('required')">
              Engine Number is required.
            </mat-error>
            <mat-error *ngIf="additionalDetailsForm.get('engineNo')?.hasError('engineNoInvalid')">
              {{ additionalDetailsForm.get('engineNo')?.errors?.['engineNoInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Color</mat-label>
            <input matInput formControlName="color" placeholder="Enter color" required maxlength="60">
            <mat-error *ngIf="additionalDetailsForm.get('color')?.hasError('required')">
              Color is required.
            </mat-error>
            <mat-error *ngIf="additionalDetailsForm.get('color')?.hasError('pattern')">
              Color must contain only letters.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Review Step -->
    <mat-step>
      <ng-template matStepLabel>Review</ng-template>
      <div class="review-content">
        <p>Your vehicle type is: {{ basicInfoForm.value.vehicleType }}</p>
        <p>Your make is: {{ basicInfoForm.value.make }}</p>
        <p>Your model is: {{ basicInfoForm.value.model }}</p>
        <p>Your model year is: {{ vehicleDetailsForm.value.modelYear }}</p>
        <p>Your purchase year is: {{ vehicleDetailsForm.value.purchaseYear }}</p>
        <p>Your purchase amount is: {{ vehicleDetailsForm.value.purchaseAmount }}</p>
        <p>Your VIN is: {{ additionalDetailsForm.value.vin }}</p>
        <p>Your engine number is: {{ additionalDetailsForm.value.engineNo }}</p>
        <p>Your color is: {{ additionalDetailsForm.value.color }}</p>
      </div>

      <div class="button-group">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button type="submit">Submit</button>
      </div>
    </mat-step>
  </mat-stepper>
</form>
