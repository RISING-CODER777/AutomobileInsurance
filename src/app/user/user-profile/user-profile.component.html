<!-- div to eliminate top nav bar overlap -->
<div style="height: 70px;"></div>

<div class="profile-container">
  <div class="banner-container">
    <p *ngIf="!errorMessage">My Profile</p>
    <p *ngIf="errorMessage" ngClass="danger">{{ errorMessage }}</p>
  </div>

  <div class="profile-content" *ngIf="userProfile">
    <div class="profile-card">
      <!-- Profile Image Upload -->
      <div class="profile-header">
        <img src="path/to/profile-image.jpg" alt="Profile Image" class="profile-image" />
        <button mat-button class="upload-button">Upload Image</button>
      </div>

      <!-- Personal Information Card -->
      <div class="personal-info-card">
        <div class="info-header">
          <p>Profile Information:</p>
          <button mat-button class="edit-button">Edit</button>
        </div>
        <p>Name: {{ userProfile.fullName }}</p>
        <p>Email: {{ userProfile.email }}</p>
        <p>Phone Number: {{ userProfile.phoneNumber }}</p>
      </div>

      <!-- Address Card -->
      <div class="address-card">
        <div class="info-header">
          <p>Address:</p>
          <button mat-button class="edit-button">Edit</button>
        </div>
        <p>Door No: {{ userProfile.doorNo }}</p>
        <p>Street: {{ userProfile.street }}</p>
        <p>Pincode: {{ userProfile.pincode }}</p>
        <p>District: {{ userProfile.district }}</p>
        <p>State: {{ userProfile.state }}</p>
      </div>
    </div>

    <!-- Policies Card -->
    <div class="policies-card">
      <p>Policies</p>
      <p *ngIf="errorMessage" ngClass="danger">{{ errorMessage }}</p>
      <p *ngIf="userPolicyLoading" style="text-align: center; padding: 10px;" ngClass="status-active">Loading...</p>
      <p *ngIf="userPolicies.length === 0 && !errorMessage && !userPolicyLoading"
        style="text-align: center; padding: 20px;">No Policies found <br>
        <button mat-icon-button (click)="getUserPolicies(userId)"><mat-icon>refresh</mat-icon></button>
      </p>

      <!-- Loop through policies -->
      <div *ngFor="let policy of userPolicies" class="policy" [attr.id]="'policy-' + policy.policyID">
        <div class="policy-info">
          <div class="general-info">
            <div>{{policy.make}}</div>
            <div [ngClass]="{
                'status-active': policy.status === 'Active',
                'status-expired': policy.status === 'Expired'
              }">
              {{policy.status}}
            </div>
          </div>

          <div *ngIf="!policy.showDoneButton" class="vehicle-info">
            {{ policy.registrationNumber }} | {{ policy.year }} | {{ policy.fuelType }}
          </div>

          <!-- Claim Form -->
          <div *ngIf="policy.showDoneButton">
            <input type="date" [(ngModel)]="claimForm.DateOfIncident" placeholder="Date of Incident" />
            <input type="text" [(ngModel)]="claimForm.Description" placeholder="Description" />
            <select [(ngModel)]="claimForm.ClaimType">
              <option value="">Select Claim Type</option>
              <option value="Damage">Damage</option>
              <option value="Theft">Theft</option>
              <option value="Accident">Accident</option>
            </select>
          </div>
        </div>

        <!-- Action Buttons for Claim or Renew -->
        <div [ngClass]="{
          'action-active-button': policy.status === 'Active',
          'action-expired-button': policy.status === 'Expired'
        }"
        [ngStyle]="{
          'opacity': policy.isClaimed ? 0.8 : 1,
          'color': policy.isClaimed ? 'grey' : 'black',
          'pointer-events': policy.isClaimed ? 'none' : 'auto'
        }"
        style="user-select: none; font-weight: 400;"
        (click)="policy.status === 'Active' ? claimPolicy(policy.policyID) : renewPolicy(policy.policyID)">
          {{policy.showDoneButton ? 'Done' : policy.status === 'Active' ? 'Claim' : 'Renew'}}
        </div>
      </div>
    </div>
  </div>
</div>
